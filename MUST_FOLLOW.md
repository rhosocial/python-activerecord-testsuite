# 测试套件迁移必须遵守的规则

## 核心原则

### 1. 测试逻辑不可更改
- 绝对禁止修改testsuite中的任何测试逻辑
- 不允许改动测试用例、断言或预期结果
- 迁移前所有测试必须通过，任何逻辑修改都可能导致测试失败

### 2. 严格遵循现有模式
- 必须完全按照basic测试组的实现方式进行迁移
- 不允许创造新的实现模式或架构
- 保持与现有实现完全一致的目录结构和文件组织方式

### 3. 后端专注性
- 每个后端包只能关注自己的配置和实现
- 禁止检查或配置其他后端类型
- 不允许跨后端的依赖或引用关系

### 4. 直接导入原则
- 必须使用直接导入方式运行testsuite测试
- 禁止复制测试代码到后端包中
- 桥接文件只能包含必要的导入语句和环境变量设置

### 5. Provider实现规范
- 必须严格实现testsuite定义的接口
- 只能提供场景配置和模型设置功能
- 禁止在Provider中包含业务逻辑或测试逻辑

### 6. Schema管理要求
- 后端负责管理自己的数据库schema
- Schema文件必须与模型定义完全匹配
- 禁止手动修改testsuite中的模型定义

### 7. 测试执行约束
- 测试执行命令必须固定为: `PYTHONPATH=src:tests pytest`
- 禁止修改PYTHONPATH或添加其他路径设置
- 测试必须能够在不修改环境的情况下直接运行

### 8. 文件命名一致性
- testsuite中的测试文件命名必须与原始测试保持完全一致
- 禁止添加后缀或前缀修改文件名
- 必须保持完全相同的函数名和类名

### 9. 环境变量规范
- 只能使用规定的环境变量控制测试行为
- 禁止添加自定义环境变量
- 环境变量使用必须与testsuite文档描述一致

### 10. 错误处理要求
- 当测试失败时，必须保持原始错误信息
- 禁止捕获或修改测试异常
- 禁止添加额外的错误处理逻辑

## 迁移实现要求

### 1. 目录结构
- 必须在testsuite中创建对应的测试组目录
- 必须在后端tests目录中创建对应的桥接文件
- 目录层级和文件组织必须与basic组完全一致

### 2. 接口定义
- 必须在testsuite中定义标准的Provider接口
- 接口方法签名必须清晰明确
- 必须继承ABC基类并使用抽象方法装饰器

### 3. 测试文件
- testsuite中的测试文件必须与原始测试逻辑完全一致
- 不允许添加、删除或修改任何测试用例
- 测试文件命名必须保持一致

### 4. Provider实现
- 后端必须实现testsuite定义的所有接口方法
- 实现必须注册到Provider注册表中
- 不能遗漏任何必需的接口方法

### 5. 桥接文件
- 必须在后端创建与testsuite对应的桥接文件
- 桥接文件只能包含导入语句和必要设置
- 禁止在桥接文件中添加任何测试逻辑

### 6. Schema文件
- 必须在后端创建与模型匹配的schema文件
- schema文件必须能够正确创建对应的数据库表
- 禁止手动修改schema结构

## 验证标准

### 1. 测试通过性
- 所有迁移后的测试必须能够正常运行并通过
- 不允许出现因迁移导致的测试失败
- 必须保持与原始测试相同的通过率

### 2. 代码一致性
- 迁移后的代码必须与原始实现保持功能一致
- 不允许引入新的bug或问题
- 必须通过所有现有的质量检查

### 3. 文档完整性
- 必须更新相关文档以反映迁移变化
- 文档描述必须准确无误
- 不能遗漏重要的实现细节

这些规则是确保测试套件迁移质量和正确性的根本保障，必须严格遵守。